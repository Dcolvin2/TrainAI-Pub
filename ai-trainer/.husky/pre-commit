#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "🔍 Running pre-commit checks..."

# Run ESLint with auto-fix on staged files
echo "📝 Checking and fixing code style..."
npx lint-staged

# Run TypeScript type checking
echo "🔧 Checking TypeScript types..."
npm run type-check

# If TypeScript check fails, prevent commit
if [ $? -ne 0 ]; then
    echo "❌ TypeScript errors found. Commit blocked."
    echo "💡 Run 'npm run type-check' to see details."
    exit 1
fi

# Run a quick build check
echo "🏗️ Running build check..."
npm run build --silent

# If build fails, prevent commit
if [ $? -ne 0 ]; then
    echo "❌ Build errors found. Commit blocked."
    echo "💡 Run 'npm run build' to see details."
    exit 1
fi

echo "✅ All checks passed! Proceeding with commit." 